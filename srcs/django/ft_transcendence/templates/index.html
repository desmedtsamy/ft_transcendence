{% extends 'base.html' %}

{% block title %}
	Home
{% endblock %}
{% block content %}
<h1 id="neon">PONG</h1>



<style>
	#court {
		width: 90%; /* Largeur du terrain à 90% de la largeur de l'écran */
		height: calc(42em);
		max-height: 80vh; /* Limite la hauteur maximale à 80% de la hauteur de la fenêtre */
		background-color: black;
		position: relative;
		margin: 0 auto;
	}
	
	.paddle {
		width: 1em;
		height: 5em;
		background-color: white;
		position: absolute;
		top: 75px; /* Position initiale */
	}
	
	#player {
		left: 1em;
	}
	
	#computer {
		right: 1em;
	}
	
	#ball {
		width: 1em;
		height: 1em;
		background-color: white;
		position: absolute;
		top: 95px; /* Position initiale */
		left: 195px; /* Position initiale */
	}
	
	#startButton {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		padding: 10px 20px;
		background-color: white;
		border: none;
		cursor: pointer;

	.score {
		position: absolute;
		top: 10px; /* Position en haut */
		font-size: 24px;
		color: white;
	}
	
	#playerScore {
		left: 20px; /* Position à gauche */
	}
	
	#computerScore {
		right: 20px; /* Position à droite */
	}
	}
	</style>
	<div id="court">
		<div class="score" id="playerScore">0</div>
		<div class="score" id="computerScore">0</div>
		<div class="paddle" id="player"></div>
		<div class="paddle" id="computer"></div>
		<div id="ball"></div>
		<button id="startButton">Démarrer</button>
	</div>


<script>
	const court = document.getElementById("court");
	const paddle = document.getElementById("player");
	const player = document.getElementById("player");
	const computer = document.getElementById("computer");
	const ball = document.getElementById("ball");
	const startButton = document.getElementById("startButton");
	
	let ballX = 195;
	let ballY = 95;
	let ballSpeedX = 2;
	let ballSpeedY = 2;
	let ballSize = 2;
	let paddleWidth = 2;
	
	let playerScore = 0;
	let computerScore = 0;
	let gameStarted = false;
	
	startButton.addEventListener("click", startGame);
	
	function startGame() {
		gameStarted = true;
		startButton.style.display = "none";
	
		// Obtenir les dimensions réelles du terrain après que le CSS a été appliqué
		const courtRect = court.getBoundingClientRect();
		const courtWidth = courtRect.width;
		const courtHeight = courtRect.height;
	
		const paddleRect = paddle.getBoundingClientRect();
		const paddleWidth = paddleRect.width;
		const paddleHeight = paddleRect.height;
		// Calculer les dimensions dynamiques des raquettes et de la balle
		const ballSize = ball.getBoundingClientRect().width; // 2.5% de la largeur du terrain
	
		setInterval(() => gameLoop(courtWidth, courtHeight, paddleHeight), 10); // Passer les dimensions à gameLoop
	}
	
	
function gameLoop(courtWidth, courtHeight, paddleHeight) {
    if (!gameStarted) return;

    ballX += ballSpeedX;
    ballY += ballSpeedY;

    // Détection des collisions avec les murs (utiliser les dimensions dynamiques)
    if (ballY <= 0 || ballY >= courtHeight - ballSize) {
        ballSpeedY = -ballSpeedY;
    }

    // Détection des collisions avec les raquettes (utiliser les dimensions dynamiques)
    if (
        (ballX <= paddleWidth && ballY >= player.offsetTop && ballY <= player.offsetTop + paddleHeight) ||
        (ballX >= courtWidth - paddleWidth - ballSize && ballY >= computer.offsetTop && ballY <= computer.offsetTop + paddleHeight)
    ) {
        ballSpeedX = -ballSpeedX;
    }

    // Détection des scores (utiliser les dimensions dynamiques)
    if (ballX <= 0) {
        computerScore++;
        resetBall(courtWidth); // Passer courtWidth à resetBall
    }
    if (ballX >= courtWidth - ballSize) {
        playerScore++;
        resetBall(courtWidth); // Passer courtWidth à resetBall
    }

    // Mise à jour des positions
    ball.style.left = ballX + "px";
    ball.style.top = ballY + "px";

    // Mouvement du bot (simple)
    computer.style.top = ballY - paddleHeight / 2 + "px"; // Utiliser paddleHeight

    // Vérifier si un joueur a atteint 10 points
    if (playerScore === 10 || computerScore === 10) {
        endGame();
    }

    // Mise à jour des scores
    document.getElementById("playerScore").textContent = playerScore;
    document.getElementById("computerScore").textContent = computerScore;
}

function resetBall(courtWidth) { // Accepter courtWidth en argument
    ballX = courtWidth / 2 - ballSize / 2; // Positionner la balle au centre horizontalement
    ballY = courtHeight / 2 - ballSize / 2; // Positionner la balle au centre verticalement
    ballSpeedX = -ballSpeedX;
}
	
	function endGame() {
		gameStarted = false;
		alert("Fin de la partie ! Score : Joueur " + playerScore + " - Ordinateur " + computerScore);
		// Réinitialiser le jeu (scores, positions, etc.) ici
	}
	
	// Déplacement de la raquette du joueur avec la souris
	court.addEventListener("mousemove", (event) => {
		player.style.top = event.clientY - court.offsetTop - 25 + "px"; 
	});
	</script>

{% endblock %}
